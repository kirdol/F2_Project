## Project 2

## Initial Setup

```{r setup, message=FALSE}
source(here::here("scripts", "setup.R"))
data <- read.csv(here("data", "data_export_20240424.csv"), sep = ";")
```

## Date format
```{r Date format}
# Convert the 'Month' column to a date type
data$Month <- as.Date(data$Month, format = "%d.%m.%y")

# Convert the data frame to a tsibble
data_tsibble <- as_tsibble(data, index = Month)
```

## ARIMA Model for Coal Production
```{r ARIMA Model}
# Extract the time series for Coal production
coal_ts <- as.ts(data_tsibble$Coal_Production)

# Fit an ARIMA model
arima_model <- auto.arima(coal_ts)

# Forecast using the ARIMA model
forecast_result <- forecast(arima_model, h = 24)

# Plot the forecast
autoplot(forecast_result) +
  labs(title = "ARIMA Forecast of Coal Production",
       y = "Coal Production",
       x = "Time")

arima_model
```

## Random Forest Model for Coal Production (Does not work yet)
```{r Random Forest, eval=FALSE}
library(randomForest)
# Prepare the data for random forest
# Create lagged features
lag_data <- slide(data_tsibble, .before = 1) %>%
  mutate(future_production = lead(Coal_production)) %>%
  drop_na()

# Create lagged features
lag_data <- data_tsibble %>%
  mutate(Coal_production_lag1 = lag(Coal_production, 1)) %>%
  mutate(Coal_production_lag2 = lag(Coal_production, 2)) %>%
  mutate(Coal_production_lag3 = lag(Coal_production, 3)) %>%
  drop_na()

# Prepare data for modeling
train_data <- head(lag_data, -24)  # Training data
test_data <- tail(lag_data, 24)    # Testing data for the next 2 years

# Train the random forest model
rf_model <- randomForest(Coal_production ~ ., data = train_data)

# Make predictions
predictions <- predict(rf_model, newdata = test_data)

# Plot the forecast
autoplot(data_tsibble) +
  autolayer(as_tsibble(test_data$Coal_production, index = test_data$Month), series = "Actual") +
  autolayer(as_tsibble(predictions, index = test_data$Month), series = "Forecast") +
  labs(title = "Random Forest Forecast of Coal Production",
       y = "Coal Production",
       x = "Time")
```

## Neural network model for Coal Production (Does not work yet)
```{r Neural Network, eval=FALSE}
library(nnet)
fit <- nnetar(data, lambda=0)
autoplot(forecast(fit,h=30))
```